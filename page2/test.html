<!DOCTYPE html>
<html lang="en">

<head>
    <title>测试</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        body {
            background-color: #fff;
            color: #444;
        }

        .select {
            position: absolute;
            right: 0;
            top: 0;
            color: #fff;
        }
    </style>
</head>

<body>


    <div class="select">
        <div>
            <span>1号楼</span>

            <div id="NO11">
                顶楼
            </div>

            <div>
                六楼
            </div>
            <div>
                五楼
            </div>
            <div>
                四楼
            </div>
            <div>
                三楼
            </div>
            <div>
                二楼
            </div>
            <div>
                一楼
            </div>
        </div>
        <div>
            <span>2号楼</span>


            <div id="NO11">
                顶楼
            </div>

            <div>
                六楼
            </div>
            <div>
                五楼
            </div>
            <div>
                四楼
            </div>
            <div>
                三楼
            </div>
            <div>
                二楼
            </div>
            <div>
                一楼
            </div>
        </div>
        <div>
            <span>3号楼</span>


            <div id="NO11">
                顶楼
            </div>

            <div>
                六楼
            </div>
            <div>
                五楼
            </div>
            <div>
                四楼
            </div>
            <div>
                三楼
            </div>
            <div>
                二楼
            </div>
            <div>
                一楼
            </div>
        </div>
    </div>


    <script async src="../js/es-module-shims.js"></script>

    <!-- <script src="../js/jsm/loaders/GLTFLoader.js"></script> -->


    <script type="importmap">
			{
				"imports": {
					"three": "../js/three.module.js"
				}
			}
		</script>

    <!-- <script src="../js/jsm/libs/stats.module.js"></script> -->
    <script type="module">
        import * as THREE from 'three';

        import { GUI } from '../js/jsm/libs/lil-gui.module.min.js';

        // import { OrbitControls } from '../js/jsm/controls/OrbitControls.js';


        import { GLTFLoader } from '../js/jsm/loaders/GLTFLoader.js';
        import { RGBELoader } from '../js/jsm/loaders/RGBELoader.js';

        import Stats from '../js/jsm/libs/stats.module.js';

        console.log(Stats);

        let stats = new Stats();


        let camera, scene, renderer
        let mesh, gltf, rgb, mix;
        let aniat, timeoutid;

        let nowsec, ingltf;





        const clock = new THREE.Clock();



        function init() {

            const container = document.createElement('div');
            document.body.appendChild(container);

            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 2000);
            camera.position.z = 50;
            camera.position.set(100, 1500, 30)

            // scene

            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000000);




            let ambient = new THREE.AmbientLight(0x666666);



            scene.add(ambient);



            const directionalLight = new THREE.DirectionalLight(0x887766);
            directionalLight.position.set(- 1, 50, 1).normalize();
            // directionalLight.castShadow = true;
            console.log("添加场景光");
            console.log(directionalLight);
            scene.add(directionalLight);

            //

            renderer = new THREE.WebGLRenderer({ antialias: true, logarithmicDepthBuffer: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);

// 同意渲染阴影
            // renderer.shadowMapEnabled = true;
            
            
            container.appendChild(renderer.domElement);

            container.appendChild(stats.domElement);


            // <img src="../mod/医院特效.gltf" alt="">

            let clip;
            const loader = new GLTFLoader().setPath('../mod/');
            loader.load('医院特效.gltf', function (gltf) {
                ingltf = gltf

                clip = gltf.animations[0];

                scene.add(gltf.scene);
                
                // gltf.scene.receiveShadow = true; 


                console.log(gltf);

                // receiveShadow
                camera = gltf.cameras[0]




                mix = new THREE.AnimationMixer(camera)
                console.log(mix);
                aniat = mix.clipAction(gltf.animations[0])
                // 播放一次动画
                aniat.setDuration(30).setLoop(THREE.LoopOnce)
                aniat.clampWhenFinished = true



                // 开始动画
                aniat.play()




                let NO11 = document.getElementById("NO11");

                console.log(ingltf);

                // NO11.onclick  = function (params) {
                //     console.log(gltf.scene.children[0].children.length);
                //     for (let index = 0; index < gltf.scene.children[0].children.length; index++) {
                //         gltf.scene.children[0].children[index].visible = false;

                //     }
                //     gltf.scene.children[0].children[0].visible = true;

                // }

                let Nobtn = document.querySelectorAll(".select>div>div")

                console.log(Nobtn);

                for (let i = 0; i < Nobtn.length; i++) {
                    Nobtn[i].onclick = function (params) {
                        console.log(i);


                        if (i < 7) {
                            console.log("----" + 1);

                            let a = i;
                            for (let index = 0; index < gltf.scene.children[0].children.length; index++) {
                                gltf.scene.children[0].children[index].visible = false;
                            }
                            gltf.scene.children[0].children[a].visible = true;


                        } else if (i < 14) {
                            console.log("----" + 2);

                            let a = i - 7;
                            for (let index = 0; index < gltf.scene.children[1].children.length; index++) {
                                gltf.scene.children[1].children[index].visible = false;
                            }
                            gltf.scene.children[1].children[a].visible = true;

                        } else if (i < i + 7 + 7) {
                            let a = i - 14;

                            console.log("----" + 3);

                            for (let index = 0; index < gltf.scene.children[2].children.length; index++) {
                                gltf.scene.children[2].children[index].visible = false;
                            }
                            gltf.scene.children[2].children[a].visible = true;

                        }


                        // for (let index = 0; index < gltf.scene.children.length; index++) {
                        //     for (let j = 0; j < gltf.scene.children[index].children.length; i++) {
                        //         gltf.scene.children[index].children[j].visible = false;   
                        //     }
                        // }


                        // if(i<=7){
                        //     gltf.scene.children[0].children[i].visible = true;                        
                        //     console.log("一号楼");
                        // }else if(i< i +7){
                        //     gltf.scene.children[1].children[i].visible = true;                        
                        //     console.log("二号楼");

                        // }else{
                        //     gltf.scene.children[2].children[i].visible = true;                        
                        //     console.log("三号楼");
                        // }


                        // console.log(gltf.scene.children[0].children.length);
                        // for (let index = 0; index < gltf.scene.children[0].children.length; index++) {
                        //     gltf.scene.children[0].children[index].visible = false;

                        // }

                    }


                }

                let select = document.querySelectorAll(".select>div>span")


                function timeout(params) {
                    if (timeoutid) {
                        clearTimeout(timeoutid)
                    }
                    timeoutid = setTimeout(() => {
                        aniat.halt(0.5)
                    }, 500)
                }
                select[0].onclick = function () {
                    for (let index = 0; index < gltf.scene.children[0].children.length; index++) {
                        gltf.scene.children[0].children[index].visible = true;

                    }
                    aniat.time = 2;
                    aniat.play();
                    timeout();
                }


                select[1].onclick = function () {
                    for (let index = 0; index < gltf.scene.children[1].children.length; index++) {
                                gltf.scene.children[1].children[index].visible = true;
                            }

                    aniat.time = 3;
                    timeout();
                }
                select[2].onclick = function () {
                    for (let index = 0; index < gltf.scene.children[2].children.length; index++) {
                                gltf.scene.children[2].children[index].visible = true;
                            }
                    aniat.time = 4;
                    timeout();
                }










                render();

            }, function name(e) {
                console.log("进度");
                console.log(e);
                console.log(e.loaded / e.total * 100);
            });


            window.addEventListener("mousewheel", (e) => {

                // console.log(aniat);
                // console.log(e);
                // aniat.play();

                let timeScale = e.deltaY > 0 ? 1 : -1;
                // console.log("动画事件");
                // console.log(aniat.getEffectiveTimeScale());
                // console.log(timeScale);
                // aniat.AnimationAction.setEffectiveTimeScale(timeScale)
                // aniat.AnimationAction.paused = false;
                // aniat.AnimationAction.play();
                // setTimeout(() => {
                // aniat.AnimationAction.halt(0.5);


                // aniat.setEffectiveTimeScale(timeScale)
                aniat.setEffectiveTimeScale(timeScale)
                aniat.paused = false;
                aniat.play();


                if (timeoutid) {
                    clearTimeout(timeoutid)
                }
                timeoutid = setTimeout(() => {
                    aniat.halt(0.5)
                }, 300)

            })



















        }
        init()





        nowsec = 0;
        let showall;


        //控制器
        // const controls = new OrbitControls(camera, renderer.domElement);

        window.addEventListener('resize', onWindowResize);
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);

        }


        //




        function animate() {
            requestAnimationFrame(animate);
            // mesh
            // mesh.rotation.x += 0.01;
            // console.log(ambient);

            // ambient.rotation.y += 0.01;

            // mesh.rotation.y += 0.01;
            // ambient.rotation.y +=0.01;
            render();


        }
        function render() {

            let delta = clock.getDelta()

            // console.log(clock.getDelta());

            mix && mix.update(delta)

            // helper.update( clock.getDelta() );
            // effect.render( scene, camera );
            renderer.render(scene, camera);

            //          FPS更新要放在渲染后
            stats.update();

            // effect.render(scene, camera);
            // renderer.render()
        }
        // render();
        animate();
    </script>

</body>

</html>